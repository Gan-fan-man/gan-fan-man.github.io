---
layout: tool
title: web查询
permalink: /tool/web查询/
---

<h2>web查询</h2>
<p>点击下方按钮 获取您的网络环境详细信息</p>

<div style="display: flex; align-items: center; justify-content: flex-start; margin-bottom: 20px;">
    <button class="tool-button" onclick="getIPAddressAndDetails()">开始检测</button>
    <div id="status-display" style="
        margin-left: 15px; /* 按钮和状态块之间留白 */
        padding: 8px 15px;
        border-radius: 4px;
        font-weight: bold;
        background-color: #f0f0f0; /* 默认背景色 */
        color: #555; /* 默认字体颜色 */
        min-width: 100px; /* 确保有足够宽度显示文本 */
        text-align: center;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    ">
        准备就绪
    </div>
</div>


<div id="results-container" style="margin-top: 0;">
    <div class="info-row">
        <div class="info-block"><span class="label">IP地址:</span> <span id="query" class="value"></span></div>
        <div class="info-block"><span class="label">代理:</span> <span id="proxy" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">DNS:</span> <span id="dns-info" class="value"></span></div>
        <div class="info-block"><span class="label">服务提供商:</span> <span id="isp" class="value"></span></div>
    </div>
    
    <div class="info-row">
        <div class="info-block"><span class="label">国家:</span> <span id="country" class="value"></span></div>
        <div class="info-block"><span class="label">国家代码:</span> <span id="countryCode" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">洲:</span> <span id="continent" class="value"></span></div>
        <div class="info-block"><span class="label">洲代码:</span> <span id="continentCode" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">地区名称:</span> <span id="regionName" class="value"></span></div>
        <div class="info-block"><span class="label">地区编码:</span> <span id="region" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">城市:</span> <span id="city" class="value"></span></div>
        <div class="info-block"><span class="label">邮编:</span> <span id="zip" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">纬度:</span> <span id="lat" class="value"></span></div>
        <div class="info-block"><span class="label">经度:</span> <span id="lon" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">行政区:</span> <span id="district" class="value"></span></div>
        <div class="info-block"><span class="label">时区:</span> <span id="timezone" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">UTC偏移:</span> <span id="offset" class="value"></span></div>
        <div class="info-block"><span class="label">货币:</span> <span id="currency" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">组织:</span> <span id="org" class="value"></span></div>
        <div class="info-block"><span class="label">AS号:</span> <span id="as" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">AS名称:</span> <span id="asname" class="value"></span></div>
        <div class="info-block"><span class="label">移动网络:</span> <span id="mobile" class="value"></span></div>
    </div>

    <div class="info-row">
        <div class="info-block"><span class="label">托管:</span> <span id="hosting" class="value"></span></div>
        <div class="info-block" style="visibility: hidden;"></div> 
    </div>

    <div id="error-message" style="color: red; margin-top: 15px; text-align: center;"></div>
</div>

<style>
    /* 现有的样式保持不变 */
    .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .info-block {
        flex: 1;
        border: 1px solid var(--tool-input-border);
        border-radius: 4px;
        padding: 10px 15px;
        margin: 0 5px;
        background-color: var(--tool-input-bg);
        color: var(--tool-input-color);
        font-size: 1em;
        display: flex;
        align-items: baseline;
    }
    .info-block:first-child {
        margin-left: 0;
    }
    .info-block:last-child {
        margin-right: 0;
    }
    .label {
        font-weight: bold;
        color: #007bff;
        margin-right: 8px;
        white-space: nowrap;
    }
    .value {
        font-weight: normal;
        flex-grow: 1;
        word-break: break-all;
    }
    #error-message {
        font-weight: bold;
    }

    /* 状态样式保持不变 */
    #status-display.checking {
        background-color: #ffc107; /* 黄色 */
        color: #333;
    }
    #status-display.success {
        background-color: #28a745; /* 绿色 */
        color: white;
    }
    #status-display.failed {
        background-color: #dc3545; /* 红色 */
        color: white;
    }
</style>

<script>
    // 定义所有需要显示的字段以及它们的默认ID，按照新的顺序
    const ALL_FIELDS = [
        'query', 'proxy', 'dns-info', 'isp', 'country', 'countryCode', 
        'continent', 'continentCode', 'regionName', 'region', 'city', 'zip', 
        'lat', 'lon', 'district', 'timezone', 'offset', 'currency', 'org', 
        'as', 'asname', 'mobile', 'hosting' 
        // 移除了 'status'，因为它是独立处理的
    ];

    // 辅助函数：清除所有结果显示区域的内容
    function clearResults() {
        const resultElements = document.querySelectorAll('#results-container .value');
        resultElements.forEach(el => el.innerText = '');
        document.getElementById('error-message').innerText = ''; // 清除错误信息
    }

    // 辅助函数：格式化显示值
    function formatDisplayValue(value) {
        // 如果值是 null 或空字符串，显示“无”
        if (value === null || value === '') {
            return '无';
        }
        // 如果值是 undefined，或者特定字符串 'N/A'，显示“未找到”
        if (value === undefined || value === 'N/A') {
            return '未找到';
        }
        // 如果是布尔值，翻译为“是”或“否”
        if (typeof value === 'boolean') {
            return value ? '是' : '否';
        }
        return value;
    }

    // 辅助函数：将所有字段的值设置为“获取失败”
    function setAllFieldsToFailed() {
        ALL_FIELDS.forEach(field => {
            const element = document.getElementById(field);
            if (element) {
                element.innerText = '获取失败';
            }
        });
    }

    // 更新状态显示块的文本和样式
    function updateStatusDisplay(text, type) {
        const statusDisplay = document.getElementById('status-display');
        statusDisplay.innerText = text;
        statusDisplay.className = ''; // 清除所有类
        statusDisplay.classList.add(type); // 添加新的类，如 'checking', 'success', 'failed'
    }

    async function getIPAddressAndDetails() {
        clearResults(); // 在每次查询前清空之前的结果
        updateStatusDisplay('正在检查', 'checking'); // 点击后立即显示“正在检查”

        const errorMessageDiv = document.getElementById('error-message');
        errorMessageDiv.innerText = ''; // 再次清空错误信息

        try {
            const detailsResponse = await fetch('http://ip-api.com/json/?lang=zh-CN');
            
            if (!detailsResponse.ok) {
                // 如果 HTTP 响应不成功，抛出错误
                throw new Error(`网络请求失败：${detailsResponse.statusText}`);
            }
            
            const detailsData = await detailsResponse.json();

            if (detailsData.status === 'success') {
                // 成功获取数据，遍历所有预设字段并更新
                ALL_FIELDS.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        let displayValue = detailsData[field];
                        // 特殊处理 'dns-info'，因为它不是直接来自 ip-api 的字段
                        if (field === 'dns-info') {
                             element.innerText = '未找到'; // ip-api不提供DNS服务器，默认“未找到”
                        } else {
                            element.innerText = formatDisplayValue(displayValue);
                        }
                    }
                });
                
                // 更新状态为“成功”
                updateStatusDisplay('成功', 'success');

            } else {
                // ip-api.com 返回状态为 'fail'
                errorMessageDiv.innerText = `获取IP详细信息失败：${detailsData.message || '未知错误'}`;
                setAllFieldsToFailed(); // 将所有字段设置为“获取失败”
                // 即使失败，也可以尝试显示 query IP
                if (detailsData.query) {
                    document.getElementById('query').innerText = formatDisplayValue(detailsData.query);
                }
                // 更新状态为“失败”
                updateStatusDisplay('失败', 'failed');
            }

        } catch (error) {
            // 捕获网络错误或其他 JS 错误
            errorMessageDiv.innerText = `发生错误：${error.message}`;
            setAllFieldsToFailed(); // 将所有字段设置为“获取失败”
            // 更新状态为“失败”
            updateStatusDisplay('失败', 'failed');
        }
    }

    // 页面加载时将状态显示为“准备就绪”
    document.addEventListener('DOMContentLoaded', () => {
        updateStatusDisplay('准备就绪', ''); // 初始状态
    });
</script>